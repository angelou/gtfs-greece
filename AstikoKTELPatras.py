#!/usr/bin/env python
# coding=utf-8

from selenium import webdriver
from selenium.webdriver.support.ui import Select
from selenium.webdriver.common.action_chains import ActionChains
import selenium.common.exceptions
import os
import re
from geopy.geocoders import Nominatim
from geopy.distance import vincenty
import googlemaps
import datetime
import transitfeed
import time
from collections import OrderedDict
import pickle


options = webdriver.ChromeOptions()
options.add_argument('headless')

# driver = webdriver.Chrome(chrome_options=options)

driver = webdriver.Chrome()

geolocator = Nominatim()

days = {
    '0' : "Δευτέρα",
    '1' : "Τρίτη",
    '2' : "Τετάρτη",
    '3' : "Πέμπτη",
    '4' : "Παρασκευή",
    '5' : "Σάββατο",
    '6' : "Κυριακή"
}

start_url = "http://jsapi.3pi-telematics.com/templateFiles/#main"
driver.implicitly_wait(5)
driver.get(start_url)

gtfs_file = os.path.basename(__file__).replace(".py",".zip")
pickle_file = os.path.basename(__file__).replace(".py",".pkl")

schedule = transitfeed.Schedule()

schedule.AddAgency(agency_id = "AstikoKTELPatras",
                   name = "ΑΣΤΙΚΟ ΚΤΕΛ ΠΑΤΡΩΝ ΑΕ",
                   timezone = "Europe/Athens",
                   url = "http://www.astikopatras.gr")


station_list = []
station_names = []
station_locations = []
station_objects = []

daytimes = OrderedDict()

if os.path.exists(pickle_file):

    with open(pickle_file, "rb") as pickla:

        daytimes = pickle.load(pickla)
        station_list = pickle.load(pickla)
        station_locations = pickle.load(pickla)
        station_names = pickle.load(pickla)

        # Let's re-create station-objects, since we can't dump them
        for station_index, station in enumerate(station_list):
            station_object = schedule.AddStop(lng = station_locations[station_index][0],
                                            lat = station_locations[station_index][1],
                                            name = station_names[station_index].encode("utf-8"),
                                            stop_id = station.encode("utf-8"))
            station_objects.append(station_object)


else:

    daytimes = {
        '1 : ΤΕΡΨΙΘΕΑ-ΕΓΛΥΚΑΔΑ - ΚΑΤΕΥΘΥΝΣΗ: ΕΓΛΥΚΑΔΑ' : {
            'daytimes' :
            {
            '01234': ['6:20', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '6:40', '7:10', '8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '15:10', '16:10', '17:10', '18:10', '19:10', '20:10', '7:20', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:20', '16:20', '17:20', '18:20', '19:20', '20:20', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '7:40', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '15:40', '16:40', '17:40', '18:40', '19:40', '20:40', '7:50', '8:50', '9:50', '10:50', '11:50', '12:50', '13:50', '14:50', '15:50', '16:50', '17:50', '18:50', '19:50', '20:50', '21:00', '22:00', '21:15', '22:15', '21:30', '22:30', '21:45', '22:40'],
            '02'   : ['15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '15:12', '16:12', '17:12', '18:12', '19:12', '20:12', '15:24', '16:24', '17:24', '18:24', '19:24', '20:24', '15:36', '16:36', '17:36', '18:36', '19:36', '20:36', '15:48', '16:48', '17:48', '18:48', '19:48', '20:48', '21:00', '22:00', '21:15', '22:15', '21:30', '22:30', '21:45', '22:40'],
            '5'    : ['6:20', '7:00', '6:40', '7:10', '8:00', '9:00', '8:10', '9:10', '10:00', '11:00', '10:10', '11:10', '10:20', '11:20', '10:30', '11:30', '10:40', '11:40', '10:50', '11:50', '12:00', '13:00', '12:10', '13:10', '12:20', '13:20', '12:30', '13:30', '12:40', '13:40', '12:50', '13:50', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:10', '22:10', '14:10', '15:15', '16:15', '17:15', '18:15', '19:15', '20:15', '21:30', '22:30', '14:20', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:50', '22:40', '14:30', '15:45', '16:45', '17:45', '18:45', '19:45', '20:50', '14:40', '14:50', '7:20', '8:20', '9:20', '7:30', '8:30', '9:30', '7:40', '8:40', '9:40', '7:50', '8:50', '9:50'],
            '6'    : ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:20', '16:20', '17:20', '18:20', '19:20', '20:20', '21:20', '22:20', '15:40', '16:40', '17:40', '18:40', '19:40', '20:40', '21:40', '22:40'],
            } ,
            'stops' : []

        },
        '1 : ΤΕΡΨΙΘΕΑ-ΕΓΛΥΚΑΔΑ - ΚΑΤΕΥΘΥΝΣΗ: ΤΕΡΨΙΘΕΑ' : {
            'daytimes' : {
                '01234': ['6:20', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '6:40', '7:10', '8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '15:10', '16:10', '17:10', '18:10', '19:10', '20:10', '7:20', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:20', '16:20', '17:20', '18:20', '19:20', '20:20', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '7:40', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '15:40', '16:40', '17:40', '18:40', '19:40', '20:40', '7:50', '8:50', '9:50', '10:50', '11:50', '12:50', '13:50', '14:50', '15:50', '16:50', '17:50', '18:50', '19:50', '20:50', '21:00', '22:00', '21:15', '22:15', '21:30', '22:30', '21:45', '22:40'],
                '02'   : ['15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '15:12', '16:12', '17:12', '18:12', '19:12', '20:12', '15:24', '16:24', '17:24', '18:24', '19:24', '20:24', '15:36', '16:36', '17:36', '18:36', '19:36', '20:36', '15:48', '16:48', '17:48', '18:48', '19:48', '20:48', '21:00', '22:00', '21:15', '22:15', '21:30', '22:30', '21:45', '22:40'],
                '5'    : ['6:20', '7:00', '6:40', '7:10', '8:00', '9:00', '8:10', '9:10', '7:20', '8:20', '9:20', '7:30', '8:30', '9:30', '7:40', '8:40', '9:40', '7:50', '8:50', '9:50', '10:00', '11:00', '10:10', '11:10', '10:20', '11:20', '10:30', '11:30', '10:40', '11:40', '10:50', '11:50', '12:00', '13:00', '12:10', '13:10', '12:20', '13:20', '12:30', '13:30', '12:40', '13:40', '12:50', '13:50', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:10', '22:10', '14:10', '15:15', '16:15', '17:15', '18:15', '19:15', '20:15', '21:30', '22:30', '14:20', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:50', '22:40', '14:30', '15:45', '16:45', '17:45', '18:45', '19:45', '20:50', '14:40', '14:50'],
                '6'    : ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:20', '16:20', '17:20', '18:20', '19:20', '20:20', '21:20', '22:20', '15:40', '16:40', '17:40', '18:40', '19:40', '20:40', '21:40', '22:40'],
            },
            'stops' : []

        },
        '1 : ΠΛΑΖ-ΡΩΜΑΝΟΥ - ΚΑΤΕΥΘΥΝΣΗ: ΤΕΡΨΙΘΕΑ ΡΩΜΑΝΟΥ ΕΛΕΚΙΣΤΡΑ' : {
            'daytimes' : {
                '01234' : ['14:50']
            },
            'stops' : []
        },
        '1 : ΠΛΑΖ-ΡΩΜΑΝΟΥ - ΚΑΤΕΥΘΥΝΣΗ: ΕΛΕΚΙΣΤΡΑ ΡΩΜΑΝΟΥ ΤΕΡΨΙΘΕΑ' : {
            'daytimes' : {
            '01234' : ['07:00']
            },
            'stops' : []
        },
        '1 : ΤΕΡΨΙΘΕΑ-ΔΙΑΚΟΥ - ΚΑΤΕΥΘΥΝΣΗ: ΔΙΑΚΟΥ' : {},
        '1 : ΤΕΡΨΙΘΕΑ-ΔΙΑΚΟΥ - ΚΑΤΕΥΘΥΝΣΗ: ΤΕΡΨΙΘΕΑ' : {},
        '1 : ΤΕΡΨΙΘΕΑ-ΔΙΑΚΟΥ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΛΥΚΟΧΩΡΟ ΔΙΑΚΟΥ' : {},
        '1 : ΡΩΜΑΝΟΥ - ΣΥΝΟΡΑ - ΚΑΤΕΥΘΥΝΣΗ: ΡΩΜΑΝΟΥ-ΣΥΝΟΡΑ' : {},

        '2 : ΤΑΡΑΜΠΟΥΡΑ - ΝΕΟΣ ΔΡΟΜΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΣΥΧΑΙΝΑ ΝΕΟ ΔΡΟΜΟ' : {
            'daytimes':
                {
                '01234' : ['5:30', '6:00', '7:00', '6:20', '7:08', '6:40', '7:16', '8:04', '9:00', '8:12', '9:08', '8:20', '9:16', '7:24', '8:28', '9:24', '7:32', '8:36', '9:32', '7:40', '8:44', '9:40', '7:48', '8:52', '9:48', '10:04', '10:12', '10:20', '10:28', '10:36', '10:44', '10:52', '11:00', '12:04', '13:00', '11:08', '12:12', '13:08', '11:16', '12:20', '13:16', '11:24', '12:28', '13:24', '11:32', '12:36', '13:32', '11:40', '12:44', '13:40', '11:48', '12:52', '13:48', '11:56', '14:00', '15:00', '14:10', '15:10', '14:20', '15:20', '14:30', '15:30', '14:40', '15:40', '14:50', '15:50', '16:00', '16:10', '16:20', '16:30', '16:38', '16:46', '16:54', '17:02', '18:06', '17:10', '18:14', '17:18', '18:22', '17:26', '18:30', '17:34', '18:38', '17:42', '18:46', '17:50', '18:54', '17:58', '19:02', '20:06', '21:00', '19:10', '20:14', '21:10', '19:18', '20:22', '21:20', '19:26', '20:30', '21:30', '19:34', '20:40', '21:40', '19:42', '20:50', '19:50', '19:58', '22:00', '23:15', '22:20', '22:40', '7:56', '9:56'],
                '5' : ['6:00', '7:00', '6:20', '7:10', '6:40', '7:20', '8:00', '9:00', '10:00', '11:00', '8:10', '9:10', '10:10', '11:10', '8:20', '9:20', '10:20', '11:20', '12:00', '13:00', '12:10', '13:10', '12:20', '13:20', '12:30', '13:30', '12:40', '13:40', '12:50', '13:50', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:15', '14:10', '15:15', '16:15', '17:15', '18:15', '19:15', '20:20', '21:20', '22:20', '14:20', '15:30', '16:30', '17:30', '18:30', '19:30', '20:40', '21:40', '22:40', '14:30', '15:45', '16:45', '17:45', '18:45', '19:45', '14:40', '14:50', '7:30', '8:30', '9:30', '10:30', '11:30', '7:40', '8:40', '9:40', '10:40', '11:40', '7:50', '8:50', '9:50', '10:50', '11:50'],
                '6' : ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:15', '16:15', '17:15', '18:15', '19:15', '20:15', '21:15', '22:15', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30', '22:30', '15:45', '16:45', '17:45', '18:45', '19:45', '20:45', '21:45', '22:40']
                },
            'stops' : []
        },
        '2 : ΤΑΡΑΜΠΟΥΡΑ - ΝΕΟΣ ΔΡΟΜΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΤΑΡΑΜΠΟΥΡΑ Τ.Ε.Ι.' : {
            'daytimes':
                {
                '01234' : ['6:00', '7:00', '8:04', '9:00', '10:04', '11:00', '12:04', '13:00', '14:00', '15:00', '16:00', '17:02', '18:06', '19:02', '20:06', '21:00', '22:00', '23:15', '23:59', '6:20', '7:08', '6:40', '7:16', '8:12', '9:08', '8:20', '9:16', '7:24', '8:28', '9:24', '7:32', '8:36', '9:32', '7:40', '8:44', '9:40', '7:48', '8:52', '9:48', '10:12', '11:08', '10:20', '11:16', '10:28', '11:24', '10:36', '11:32', '10:44', '11:40', '10:52', '11:48', '11:56', '12:12', '13:08', '12:20', '13:16', '12:28', '13:24', '12:36', '13:32', '12:44', '13:40', '12:52', '13:48', '14:10', '15:10', '14:20', '15:20', '14:30', '15:30', '14:40', '15:40', '14:50', '15:50', '16:10', '17:10', '16:20', '17:18', '16:30', '17:26', '16:38', '17:34', '16:46', '17:42', '16:54', '17:50', '17:58', '18:14', '18:22', '18:30', '18:38', '18:46', '18:54', '19:10', '20:14', '19:18', '20:22', '19:26', '20:30', '19:34', '20:40', '19:42', '20:50', '19:50', '19:58', '21:10', '22:20', '21:20', '22:40', '21:30', '21:40', '7:56', '9:56'],
                '5'     : ['6:30', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '6:50', '7:10', '8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '7:20', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '7:40', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '7:50', '8:50', '9:50', '10:50', '11:50', '12:50', '13:50', '14:50', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:15', '23:59', '15:15', '16:15', '17:15', '18:15', '19:15', '20:20', '21:20', '22:20', '15:30', '16:30', '17:30', '18:30', '19:30', '20:40', '21:40', '22:40', '15:45', '16:45', '17:45', '18:45', '19:45'],
                '6'     : ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:59', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:15', '16:15', '17:15', '18:15', '19:15', '20:15', '21:15', '22:15', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30', '22:30', '15:45', '16:45', '17:45', '18:45', '19:45', '20:45', '21:45', '22:40']
                },
            'stops' : []
        },
        '2 : ΤΑΡΑΜΠΟΥΡΑ - ΝΕΟΣ ΔΡΟΜΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΝΕΟ ΔΡΟΜΟ ΥΠΗΡΕΣΙΑΚΟ ΠΡΩΙ' : {},
        '2 : ΤΑΡΑΜΠΟΥΡΑ - ΝΕΟΣ ΔΡΟΜΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΤΕΙ ΤΕΛΕΥΤΑΙΟ ΒΡΑΔΥΝΟ' : {},

        '3 : ΖΑΡΟΥΧΛΕΪΚΑ - ΘΕΡΜΟΠΥΛΩΝ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΘΕΡΜΟΠΥΛΩΝ' : {
            'daytimes' :
                {
                    '01234' : ['6:00', '7:00', '8:04', '9:00', '8:12', '9:08', '8:20', '9:16', '8:28', '9:24', '10:04', '10:12', '10:20', '10:28', '10:36', '10:44', '10:52', '11:00', '12:04', '13:00', '11:08', '12:12', '13:08', '11:16', '12:20', '13:16', '11:24', '12:28', '13:24', '11:32', '12:36', '13:32', '11:40', '12:44', '13:40', '11:48', '12:52', '13:48', '11:56', '13:56', '14:04', '15:00', '16:00', '14:12', '15:10', '16:10', '14:20', '15:20', '16:20', '14:30', '15:30', '16:30', '14:40', '15:40', '16:40', '14:50', '15:50', '16:50', '17:00', '18:05', '17:10', '18:12', '17:20', '18:19', '17:30', '18:26', '17:37', '18:33', '17:44', '18:41', '17:51', '18:48', '17:58', '18:55', '19:02', '20:05', '19:09', '20:12', '19:16', '20:19', '19:23', '20:30', '19:30', '20:45', '19:37', '19:44', '19:51', '19:58', '21:00', '22:00', '21:15', '22:15', '21:30', '22:30', '21:45', '22:40', '5:20', '6:20', '7:08', '6:40', '7:16', '5:20', '5:30', '6:50', '7:24', '7:32', '8:36', '9:32', '7:40', '8:44', '9:40', '7:48', '8:52', '9:48', '7:56', '9:56'],
                    '5'     : ['6:00', '7:00', '6:20', '7:20', '6:40', '7:40', '7:50', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '8:50', '9:50', '10:50', '11:50', '12:50', '13:50', '14:50', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:10', '22:10', '15:15', '16:15', '17:15', '18:15', '19:15', '20:15', '21:30', '22:30', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:50', '22:40', '15:45', '16:45', '17:45', '18:45', '19:45', '20:50'],
                    '6'     : ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:20', '16:20', '17:20', '18:20', '19:20', '20:20', '21:20', '22:20', '15:40', '16:40', '17:40', '18:40', '19:40', '20:40', '21:40', '22:40']
                },
            'stops' : []
        },
        "3 : ΖΑΡΟΥΧΛΕΪΚΑ - ΘΕΡΜΟΠΥΛΩΝ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΖΑΡΟΥΧΛΕ'Ι'ΚΑ" : {
            'daytimes' :
                {
                    '01234' : ['6:00', '7:00', '6:30', '7:08', '6:50', '7:16', '8:04', '9:00', '8:12', '9:08', '8:20', '9:16', '10:04', '11:00', '10:12', '11:08', '10:20', '11:16', '10:28', '11:24', '10:36', '11:32', '10:44', '11:40', '10:52', '11:48', '11:56', '12:04', '13:00', '12:12', '13:08', '12:20', '13:16', '12:28', '13:24', '12:36', '13:32', '12:44', '13:40', '12:52', '13:48', '13:56', '14:04', '15:00', '16:00', '14:12', '15:10', '16:10', '14:20', '15:20', '16:20', '14:30', '15:30', '16:30', '14:40', '15:40', '16:40', '14:50', '15:50', '16:50', '17:00', '18:05', '17:10', '18:12', '17:20', '18:19', '17:30', '18:26', '17:37', '18:33', '17:44', '18:41', '17:51', '18:48', '17:58', '18:55', '19:02', '20:05', '19:09', '20:12', '19:16', '20:19', '19:23', '20:30', '19:30', '20:45', '19:37', '19:44', '19:51', '19:58', '21:00', '22:00', '21:15', '22:15', '21:30', '22:30', '21:45', '22:40', '7:24', '8:28', '9:24', '7:32', '8:36', '9:32', '7:40', '8:44', '9:40', '7:48', '8:52', '9:48', '7:56', '9:56'],
                    '5'     : ['6:00', '7:00', '8:00', '6:20', '7:20', '8:10', '6:40', '7:40', '8:20', '9:00', '10:00', '11:00', '9:10', '10:10', '11:10', '9:20', '10:20', '11:20', '9:30', '10:30', '11:30', '12:00', '13:00', '12:10', '13:10', '12:20', '13:20', '12:30', '13:30', '12:40', '13:40', '12:50', '13:50', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:10', '22:10', '14:10', '15:15', '16:15', '17:15', '18:15', '19:15', '20:15', '21:30', '22:30', '14:20', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:50', '22:40', '14:30', '15:45', '16:45', '17:45', '18:45', '19:45', '20:50', '14:40', '14:50', '7:50', '8:30', '8:40', '9:40', '10:40', '11:40', '10:50', '11:50', '8:50', '9:50'],
                    '6'     : ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:20', '16:20', '17:20', '18:20', '19:20', '20:20', '21:20', '22:20', '15:40', '16:40', '17:40', '18:40', '19:40', '20:40', '21:40', '22:40']
                },
            'stops' :[]
        },
        "3 : ΖΑΡΟΥΧΛΕΪΚΑ - ΘΕΡΜΟΠΥΛΩΝ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΖΑΡΟΥΧΛΕΙΚΑ ΛΕΥΚΑ" : {},

        '4 : ΑΡΟΗ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΑΡΟΗ' : {
            'daytimes' : {
                '01234' : ['6:30', '7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00', '19:00', '19:30', '20:00', '20:30', '21:00', '21:30'],
                '5'     : ['7:00', '7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00'],
            },
            'stops' : []
        },
        '4 : ΑΡΟΗ - ΚΑΤΕΥΘΥΝΣΗ: ΑΡΟΗ ΠΑΤΡΑ' : {
            'daytimes' : {
                '01234' : ['6:45', '7:15', '7:45', '8:15', '8:45', '9:15', '9:45', '10:15', '10:45', '11:45', '12:15', '12:45', '13:15', '13:45', '14:15', '14:45', '15:15', '15:45', '16:15', '16:45', '17:15', '17:45', '18:15', '19:15', '19:45', '20:15', '20:45', '21:15', '21:45'],
                    '5' : ['7:15', '7:45', '8:15', '8:45', '9:15', '9:45', '10:15', '10:45', '11:45', '12:15', '12:45', '13:15', '13:45', '14:15', '14:45']
            },
            'stops' : []
        },

        "5 : ΤΣΟΥΚΑΛΕΙΚΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΤΣΟΥΚΑΛΕΊ'ΚΑ" : {
            'daytimes' : {
                '01234' : ['5:30', '6:25', '7:20', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '21:00', '22:00', '22:40'],
                '5'     : ['6:25', '7:20', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '21:00', '22:00', '22:40'],
                '6'     : ['6:25', '7:20', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '21:00', '22:00', '22:40']
            },
            'stops' : []
        },
        "5 : ΤΣΟΥΚΑΛΕΙΚΑ - ΚΑΤΕΥΘΥΝΣΗ: ΤΣΟΥΚΑΛΕ'Ι'ΚΑ  ΠΑΤΡΑ" : {
            'daytimes' : {
                '01234' : ['6:00', '6:55', '7:55', '8:55', '9:55', '10:55', '11:55', '12:55', '13:55', '14:55', '21:35', '22:40', '23:10'],
                '5'     : ['6:55', '7:55', '8:55', '9:55', '10:55', '11:55', '12:55', '13:55', '14:55', '21:35', '22:40', '23:10'],
                '6'     : ['6:55', '7:55', '8:55', '9:55', '10:55', '11:55', '12:55', '13:55', '14:55', '21:35', '22:40', '23:10']
            },
            'stops' : []
        },

        "5 : ΤΣΟΥΚΑΛΕΙΚΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΜΟΝΟΔΕΝΔΡΙ ΤΣΟΥΚΑΛΕ'Ι'ΚΑ" : {
            'daytimes' : {
                '01234' : ['6:00', '6:55', '7:40', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30'],
                '5'     : ['6:55', '7:40', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30'],
                '6'     : ['7:40', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30']
            },
            'stops' : []
        },
        "5 : ΤΣΟΥΚΑΛΕΙΚΑ - ΚΑΤΕΥΘΥΝΣΗ: ΤΣΟΥΚΑΛΕ'Ι'ΚΑ ΜΟΝΟΔΕΝΔΡΙ ΠΑΤΡΑ" : {
            'daytimes' : {
                '01234' : ['6:30', '7:25', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:20', '16:10', '17:10', '18:10', '19:10', '20:10', '21:05', '22:05'],
                '5'     : ['7:25', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:20', '16:10', '17:10', '18:10', '19:10', '20:10', '21:05', '22:05'],
                '6'     : ['8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:20', '16:10', '17:10', '18:10', '19:10', '20:10', '21:05', '22:05']
            },
            'stops' : []
        },

        "6 : ΠΑΝΕΠΙΣΤΗΜΙΟ-EXPRESS - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΠΑΝΕΠΙΣΤΗΜΙΟ (EXPRESS)" : {
            'daytimes' : {
                '01234' : ['7:30', '8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:45', '18:30', '19:15', '20:00', '20:45', '21:30']
            },
            'stops' : []
        },
        "6 : ΠΑΝΕΠΙΣΤΗΜΙΟ-EXPRESS - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΝΕΠΙΣΤΗΜΙΟ ΠΑΤΡΑ (EXPRESS)" : {
            'daytimes' : {
                '01234' : ['8:00', '8:30', '9:00', '9:30', '10:00', '10:30', '11:00', '11:30', '12:00', '12:30', '13:00', '13:30', '14:00', '14:30', '15:00', '15:30', '16:00', '16:30', '17:00', '17:45', '18:30', '19:15', '20:00', '20:45', '21:30']
            },
            'stops' : []
        },
        '6 : ΕΡΜΟΥ - ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΠΑΝΕΠΙΣΤΗΜΙΟ ΝΟΣΟΚΟΜΕΙΟ' : {
            'daytimes' : {
                '01234' : ['6:50', '7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:59', '7:10', '8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '15:15', '16:15', '17:15', '18:15', '19:15', '20:15', '21:15', '22:15', '7:20', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30', '22:30', '7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:45', '16:45', '17:45', '18:45', '19:45', '20:45', '21:45', '22:40', '7:40', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40', '7:50', '8:50', '9:50', '10:50', '11:50', '12:50', '13:50', '14:50'],
                '56'    : ['7:00', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00']
            },
            'stops' : []
        },
        '6 : ΕΡΜΟΥ - ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ - ΚΑΤΕΥΘΥΝΣΗ: ΠΡΟΣ ΠΑΤΡΑ' : {
            'daytimes' : {
                '01234' : ['07:20', '07:30', '08:30', '09:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30', '22:30', '07:40', '08:40', '09:40', '10:40', '11:40', '12:40', '13:40', '14:40', '15:45', '16:45', '17:45', '18:45', '19:45', '20:45', '21:45', '22:45', '07:50', '08:50', '09:50', '10:50', '11:50', '12:50', '13:50', '14:50', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00', '23:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:15', '17:15', '18:15', '19:15', '20:15', '21:15', '22:15', '23:10', '08:10', '09:10', '10:10', '11:10', '12:10', '13:10', '14:10', '15:10', '08:20', '09:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:20'],
                '56'    : ['7:30', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:30', '22:30']
            },
            'stops' : []
        },

        '6 : ΠΑΡΑΛΙΑ ΠΡΟΑΣΤΕΙΟΥ - ΚΑΣΤΕΛΛΟΚΑΜΠΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΡΑΛΙΑ ΠΡΟΑΣΤΕΙΟΥ - ΚΑΣΤΕΛΛΟΚΑΜΠΟΣ' : {
            'daytimes' : {
                '012345' : ['6:35', '7:10', '8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '15:10', '16:10', '17:10', '18:10', '19:10', '20:10', '21:20'],
                '6' : ['8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '15:10', '16:10', '17:10', '18:10', '19:10', '20:10', '21:20']
            },
            'stops' : []
        },
        '6 : ΒΟΥΝΤΕΝΗ  - ΚΑΤΕΥΘΥΝΣΗ: ΒΟΥΝΤΕΝΗ' : {
            'daytimes' : {
                '01234' : ['7:00', '10:00', '14:15'],
                '5' : ['7:00', '10:00']
            },
            'stops' : []
        },
        '6 : ΒΟΥΝΤΕΝΗ  - ΚΑΤΕΥΘΥΝΣΗ: ΒΟΥΝΤΕΝΗ ΠΑΤΡΑ' : {
            'daytimes' : {
                '01234' : ['7:30', '10:30', '14:45'],
                '5' : ['7:30', '10:30']
            },
            'stops' : []
        },
        '6 : ΑΝΩ ΚΑΣΤΡΙΤΣΙ - ΚΑΤΕΥΘΥΝΣΗ: ΑΝΩ ΚΑΣΤΡΙΤΣΙ' : {
            'daytimes' : {
                '01234' : ['6:50', '9:15', '12:15', '13:55', '16:30', '21:05'],
                '5' : ['6:50', '9:15', '12:15']
            },
            'stops' : []
        },
        '6 : ΑΝΩ ΚΑΣΤΡΙΤΣΙ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ' : {
            'daytimes' : {
                '01234' : ['7:25', '9:55', '12:50', '14:35', '17:10', '21:50'],
                '5' : ['7:25', '9:55', '12:50']
            },
            'stops' : []
        },
        '6 : ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ - ΡΙΟ - ΑΓ. ΒΑΣΙΛΕΙΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ' : {},
        '6 : ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ - ΡΙΟ - ΑΓ. ΒΑΣΙΛΕΙΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ' : {
            'daytimes' : {
                '0123456' : ['8:00', '8:35', '9:35', '10:05', '11:35', '13:05', '14:35', '16:05', '17:35', '19:05', '20:35', '22:05']
            },
            'stops' : []
        },
        '6 : ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ - ΡΙΟ - ΑΓ. ΒΑΣΙΛΕΙΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΝΕΠΙΣΤΗΜΙΟ-ΝΟΣΟΚΟΜΕΙΟ-ΑΓ. ΒΑΣΙΛΕΙΟΣ-ΔΗΜΟΡΗΓ.-ΡΙΟ' : {
            'daytimes' : {
                '0123456' : ['7:25', '8:05', '9:35', '11:05', '12:35', '14:05', '15:35', '17:05', '18:35', '20:05', '21:35']
            },
            'stops' : []
        },
        '6 : ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ - ΡΙΟ - ΑΓ. ΒΑΣΙΛΕΙΟΣ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ - ΡΙΟ' : {},

        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΚΑΛΛΙΘΕΑ ΘΕΑ' : {
            'daytimes' : {
                '01234' : ['6:00', '10:30', '13:45', '15:30', '21:10', '22:20'],
                '5'     : ['7:00', '10:30', '14:30']
            },
            'stops' : []
        },
        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΚΑΛΛΙΘΕΑ ΘΕΑ ΠΑΤΡΑ': {
            'daytimes' : {
                '01234' : ['6:40', '11:10', '14:20', '16:10', '21:50', '22:50'],
                '5'     : ['7:40', '11:10', '15:10']
            },
            'stops' : []
        },

        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΚΑΛΛΙΘΕΑ ΠΑΤΡΑ' : {
            'daytimes' : {
                '6' : ['13:10']
            },
            'stops' : []
        },
        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΚΑΛΛΙΘΕΑ' : {
            'daytimes' : {
                '6' : ['12:30']
            },
            'stops' : []
        },

        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΔΕΜΕΝΙΚΑ ΚΑΛΛΙΘΕΑ' : {
            'daytimes' : {
                '01234' : ['6:50', '8:10', '12:30', '14:05', '17:10', '18:50'],
                '6'     : ['20:30']
            },
            'stops' : []
        },
        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΚΑΛΛΙΘΕΑ ΘΕΑ ΔΕΜΕΝΙΚΑ' : {
            'daytimes' : {
                '01234' : ['7:30', '8:50', '13:10', '14:45', '17:50', '19:30'],
                '6'     : ['21:10']
            },
            'stops' : []
        },

        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ Προφ.ΗΛΙΑΣ ΚΑΛΛΙΘΕΑ' : {},
        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΚΑΛΛΙΘΕΑ Προφ. ΗΛΙΑΣ ΠΑΤΡΑ' : {},
        '8 : ΠΑΤΡΑ - ΚΑΛΛΙΘΕΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ Πρ. ΗΛΙΑΣ ΚΑΛΛΙΘΕΑ ΘΕΑ' : {},

        '8 : ΑΝΩ - ΚΑΤΩ ΟΒΡΥΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΑΝΩ ΚΑΤΩ ΟΒΡΥΑ' : {
            'daytimes' : {
                '01234' : ['5:45', '6:40', '7:20', '8:00', '8:20', '8:40', '9:00', '9:40', '10:00', '10:40', '11:00', '11:20', '11:40', '12:00', '12:40', '13:00', '13:20', '14:20', '15:00', '15:20', '16:00', '16:20', '16:40', '17:00', '17:40', '18:00', '18:20', '18:40', '19:20', '19:40', '20:20', '20:40', '21:00', '21:40', '22:00', '22:40'],
                '5'     : ['5:45', '8:30', '9:00', '11:00', '11:30', '13:30', '15:30', '16:00', '16:30', '17:00', '17:30', '18:00', '18:30', '19:00', '19:30', '20:00', '21:00', '21:30', '22:00', '22:40'],
                '6'     : ['7:00', '9:00', '10:00', '11:00', '12:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:15', '22:40']
            },
            'stops' : []
        },
        '8 : ΑΝΩ - ΚΑΤΩ ΟΒΡΥΑ - ΚΑΤΕΥΘΥΝΣΗ: Α.Κ. ΟΒΡΥΑ ΠΑΤΡΑ' : {
            'daytimes' : {
                '01234' : ['6:15', '7:20', '7:55', '8:40', '9:00', '9:20', '9:40', '10:20', '10:40', '11:20', '11:40', '12:00', '12:20', '12:40', '13:20', '13:40', '14:00', '15:00', '15:40', '16:00', '16:40', '17:00', '17:20', '17:40', '18:20', '18:40', '19:00', '19:20', '20:00', '20:20', '21:00', '21:20', '21:40', '22:20', '22:40', '23:20'],
                '5'     : ['6:15', '9:10', '9:40', '11:40', '12:10', '14:10', '16:10', '16:40', '17:10', '17:40', '18:10', '18:40', '19:10', '19:40', '20:10', '20:40', '21:40', '22:10', '22:40', '23:10'],
                '6'     : ['7:30', '9:30', '11:30', '11:30', '12:30', '14:30', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '21:45', '23:10']
            },
            'stops' : []

        },

        '8 : ΑΝΩ - ΚΑΤΩ ΟΒΡΥΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΔΕΜΕΝΙΚΑ ΑΝΩ ΚΑΤΩ ΟΒΡΥΑ' : {
            'daytimes' : {
                '01234' : ['6:20', '10:20', '13:35', '14:40', '15:40', '20:00', '21:20'],
                '5'     : ['6:30', '8:00', '10:00', '12:00', '13:00', '14:00', '15:00'],
                '6'     : ['8:00', '13:00']
            },
            'stops' : []
        },
        '8 : ΑΝΩ - ΚΑΤΩ ΟΒΡΥΑ - ΚΑΤΕΥΘΥΝΣΗ: Α. Κ. ΟΒΡΥΑ ΔΕΜΕΜΕΝΙΚΑ ΠΑΤΡΑ' : {
            'daytimes' : {
                '01234' : ['6:55', '11:00', '14:15', '15:20', '16:20', '20:40', '22:00'],
                '5'     : ['7:05', '8:40', '10:40', '12:40', '13:40', '14:40', '15:40'],
                '6'     : ['8:30', '13:30']
            },
            'stops' : []
        },

        '8 : ΑΝΩ - ΚΑΤΩ ΟΒΡΥΑ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ Πρ.ΗΛΙΑΣ. Α.Κ.Οβρυα' : {
            'daytimes' : {
                '01234' : ['6:55', '7:40', '9:20', '12:20', '14:00', '19:00'],
                '5'     : ['7:30', '9:30']
            },
            'stops' : []
        },

        '8 : ΑΝΩ - ΚΑΤΩ ΟΒΡΥΑ - ΚΑΤΕΥΘΥΝΣΗ: ΟΒΡΥΑ ΔΕΜΕΝΙΚΑ ΚΟΥΚΟΥΛΙ ΠΑΤΡΑ' : {
            'daytimes' : {
                '01234' : ['7:30']
            },
            'stops' : []
        },

        '9 : ΠΑΤΡΑ - ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ ΜΕΣΩ ΕΛΛΗΝΟΣ ΣΤΡΑΤΙΩΤΟΥ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΝΕΠΙΣΤΗΜΙΟ ΝΟΣΟΚΟΜΕΙΟ ΜΕΣΩ ΕΛΛΗΝΟΣ ΣΤΡΑΤΙΩΤΟΥ' : {
            'daytimes' : {
                '01234' : ['7:40', '8:00', '9:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '8:20', '9:20', '10:20', '11:20', '12:20', '13:20', '14:20', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '8:40', '9:40', '10:40', '11:40', '12:40', '13:40', '14:40']
            },
            'stops' : []
        },
        '9 : ΠΑΤΡΑ - ΠΑΝΕΠΙΣΤΗΜΙΟ - ΝΟΣΟΚΟΜΕΙΟ ΜΕΣΩ ΕΛΛΗΝΟΣ ΣΤΡΑΤΙΩΤΟΥ - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΤΡΑ ΜΕΣΩ ΕΛΛΗΝΟΣ ΣΤΡΑΤΙΩΤΟΥ' : {
            'daytimes' : {
                '01234' : ['8:10', '9:10', '10:10', '11:10', '12:10', '13:10', '14:10', '15:10', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '8:30', '9:30', '10:30', '11:30', '12:30', '13:30', '14:30', '15:30', '16:30', '17:30', '18:30', '19:30', '20:30', '8:50', '9:50', '10:50', '11:50', '12:50', '13:50', '14:50']
            },
            'stops' : []
        },

        '11 : ΠΑΡΚΙΝ ΤΕΡΨΙΘΕΑ (ΔΕΛΦΙΝΙ) - ΚΑΤΕΥΘΥΝΣΗ: ΠΑΡΚΙΝΓΚ ΤΕΡΨΙΘΕΑ' : {
            'daytimes' : {
                '01234' : ['7:00', '7:20', '7:40', '8:00', '8:20', '8:40', '9:00', '9:20', '9:40', '10:00', '10:20', '10:40', '11:00', '11:20', '11:40', '12:00', '12:20', '12:40', '13:00', '13:20', '13:40', '14:00', '14:20', '14:40', '15:00', '15:20', '15:40', '16:00', '16:20', '16:40', '17:00', '17:20', '17:40', '18:00', '18:20', '18:40', '19:00', '19:20', '19:40', '20:00', '20:20', '20:40', '21:00', '21:20', '21:40'],
                '5'     : ['8:00', '8:20', '8:40', '9:00', '9:20', '9:40', '10:00', '10:20', '10:40', '11:00', '11:20', '11:40', '12:00', '12:20', '12:40', '13:00', '13:20', '13:40', '14:00', '14:20', '14:40', '15:00', '15:20', '15:40']
            },
            'stops' : []
        },

        '18 : ΛΙΜΑΝΙ - ΚΑΤΕΥΘΥΝΣΗ: ΛΙΜΑΝΙ' : {
            'daytimes' : {
                '0123456' : ['10:30', '11:30', '12:30', '13:30', '14:30', '15:30', '16:30', '17:30']
            },
            'stops' : []
        },
        '18 : ΛΙΜΑΝΙ - ΚΑΤΕΥΘΥΝΣΗ: ΝΕΟ ΛΙΜΑΝΙ-ΠΑΤΡΑ' : {
            'daytimes' : {
                '0123456' : ['11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '17:45']
            },
            'stops' : []
        },
    }




# Find the line select element
line_select = Select(driver.find_element_by_xpath("//select[@id='line']"))
for line_index, line in enumerate(line_select.options[1:]):

    if os.path.exists(pickle_file):
        break

    line_select.select_by_index(line_index + 1)


    # Now, find the direction select element
    direction_select = Select(driver.find_element_by_xpath("//select[@id='direction']"))
    for direction_index, direction in enumerate(direction_select.options[1:]):
        for i in range(1, 5):
            _direction_select = Select(driver.find_element_by_xpath("//select[@id='direction']"))
            time.sleep(0.5)

        _direction_select.select_by_index(direction_index + 1)

        route_id = line.text.encode("utf-8") + " - ΚΑΤΕΥΘΥΝΣΗ: " + direction.text.encode("utf-8")

        if route_id not in daytimes.keys():
            print("#### RouteID %s not in keys" % route_id)
            continue

        if 'daytimes' not in daytimes[route_id].keys():
            print("#### RouteID %s has no service" % route_id)
            continue

        print("RouteID: %s" % route_id)

        route_station_list = []

        # Now, find the stop select element
        stop_select = Select(driver.find_element_by_xpath("//select[@id='station']"))

        # If we have collected all stops for this route in the pickle,
        # don't bother doing it again
        if len(stop_select.options[1:]) == len(daytimes[route_id]['stops']):
            continue

        for stop_index, stop in enumerate(stop_select.options[1:]):
            for i in range(1, 5):
                _stop_select = Select(driver.find_element_by_xpath("//select[@id='station']"))
                time.sleep(0.5)

            _stop_select.select_by_index(stop_index + 1)


            lng, lat = driver.current_url.split("_")[-1].split(",")
            # stop_id, stop_name = driver.current_url.split("_")[1:3]


            for i in range(1, 5):
                stop_info = driver.find_element_by_xpath('//*[@id="stationInfo"]/div[1]/div[1]/h3').text
                time.sleep(1.5)

            stop_name = stop_info.split(":")[1].strip()
            stop_id = stop_info.split(":")[0].strip()

            route_station_list.append(stop_id)

            daytimes[route_id]['stops'].append(stop_id)

            if stop_id not in station_list:

                stop_obj = schedule.AddStop(lng = lng,
                                            lat = lat,
                                            name = stop_name.encode("utf-8"),
                                            stop_id = stop_id.encode("utf-8"))

                station_list.append(stop_id)
                station_names.append(stop_name)
                station_objects.append(stop_obj)

                stop_location = (lng, lat)
                station_locations.append(stop_location)


        # Let's do a bit of cleanup for the cached stations

        cached_stations = driver.find_elements_by_xpath("//div[@id='cachedStations']/span/span")

        while len(cached_stations) > 0:

            for cached_station in cached_stations[::-1]:
                ActionChains(driver).move_to_element(cached_station).click().perform()

            time.sleep(3)
            cached_stations = driver.find_elements_by_xpath("//div[@id='cachedStations']/span/span")

        # Update the pickle with the most recent findings
        try:
            os.remove(pickle_file)
        except OSError:
            pass

        with open(pickle_file, "wb") as pickla:
            pickle.dump(daytimes, pickla)
            pickle.dump(station_list, pickla)
            pickle.dump(station_locations, pickla)
            pickle.dump(station_names, pickla)


driver.quit()

# Now that we have all needed,
# let's populate the GTFS data

for route_id, daytimes_info in daytimes.iteritems():

    if route_id not in daytimes.keys():
        print("#### RouteID %s not in keys" % route_id)
        continue

    if 'daytimes' not in daytimes[route_id].keys():
        print("#### RouteID %s has no service" % route_id)
        continue

    print('Adding transit info for RouteID: %s' % route_id)
    route = schedule.AddRoute(short_name = "",
                              long_name = route_id,
                              route_type = "Bus")

    for service_days, service_times in daytimes_info['daytimes'].iteritems():

        if not len(daytimes_info['stops']):
            continue

        service_id = route_id
        for service_day_index in service_days:
            service_id += '_' + days[service_day_index]

        service_period = transitfeed.ServicePeriod(service_id)
        for service_day_index in service_days:
            service_period.SetDayOfWeekHasService(int(service_day_index))

        today = datetime.datetime.today()
        service_period.SetStartDate(today.strftime('%Y%m%d'))
        service_period.SetEndDate((today + datetime.timedelta(weeks=7*4)).strftime('%Y%m%d'))
        schedule.AddServicePeriodObject(service_period)

        for service_time in service_times:
            trip = route.AddTrip(schedule, headsign=route_id, service_period=service_period)

            previous_stop = {
                'time': '',
                'location': ''
            }

            for trip_stop_index, trip_stop in enumerate(daytimes_info['stops']):

                stop_location = station_locations[station_list.index(trip_stop)]

                if not previous_stop['time']:
                    stop_time = datetime.datetime.strptime(service_time, "%H:%M")
                    trip.AddStopTime(station_objects[station_list.index(trip_stop)], stop_time = stop_time.strftime("%H:%M:%S"))
                else:
                    # Add stop time in relevance to the previous stop

                    distance = vincenty(previous_stop['location'], stop_location).meters

                    # Assume 30 km/h
                    duration = distance / 8.3
                    stop_time = previous_stop['time'] + datetime.timedelta(seconds=duration)
                    '''
                    resp = gmaps.distance_matrix(origins=previous_stop['location'],
                                                 destinations=stop_location,
                                                 mode='driving')
    
                    # Get duration in minutes
                    print("Distance from previous stop (%s) to current stop (%s)" % (previous_stop['location'], stop_location))
                    duration = resp['rows'][0]['elements'][0]['duration']['value'] / float(60)
                    print("Duration %s" % duration)
                    stop_time = previous_stop['time'] + datetime.timedelta(minutes=duration)
                    '''

                    if (int(stop_time.strftime("%H:%M:%S").split(":")[0]) < int(previous_stop['time'].strftime("%H:%M:%S").split(":")[0])) \
                    or (stop_time.strftime("%H:%M:%S").split(":")[0] == "00" and previous_stop['time'].strftime("%H:%M:%S").split(":")[0] == "00"):
                        stop_time_str = str(24 + int(stop_time.strftime("%H:%M:%S").split(":")[0])) + ":" + stop_time.strftime("%H:%M:%S").split(":")[1] + ":00"
                        trip.AddStopTime(station_objects[station_list.index(trip_stop)], stop_time=stop_time_str)
                    else:
                        trip.AddStopTime(station_objects[station_list.index(trip_stop)], stop_time=stop_time.strftime("%H:%M:%S"))


                previous_stop['time'] = stop_time
                previous_stop['location'] = stop_location


schedule.Validate()

schedule.WriteGoogleTransitFeed(gtfs_file)


